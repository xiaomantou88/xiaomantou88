---
title: 周末
date: 2016-03-20 15:55:14
tags:
- 随手记
- 生活
categories: nginx
---


#codeception概述
Codeception 是一个全堆栈的 PHP 测试框架。

*可以做以下测试：*

* Acceptance Testing（验收测试）
* Functional Testing（功能测试）
* API Testing（API 测试）
* Unit Testing（单元测试）

##官方介绍：
> 
Codeception is a new full-stack testing PHP framework. Inspired by BDD, it provides you absolutely new original way for writing acceptance, functional and even unit tests。


##官网地址:
http://codeception.com/ (需翻墙)

本地文档(182.254.140.92):/zhongan/tools/codeception/codeception/docs/

#使用步骤

##安装
1. 腾讯云开发机(182.254.140.92) /zhongan/tools/ 目录下获取codecept。

2. 将codecept放到自己home根目录下

	```
	cp /zhongan/tools/codecept ~/
	```

##初始化测试结构
1. 进入到要测试的项目代码目录:  cd 项目名/yii-advanced-app-2.0.6/

2. /usr/local/php/bin/php ~/codecept bootstrap。初始化目录结构后。会发现多出了test目录和codeception.yml文件。

##test目录结构介绍
待补充...

##创建接口测试
1. creating a new test suite (suite不知道怎么解释合适)

	```bash
		/usr/local/php/bin/php ~/codecept g:suite api
	```
>这就在test/ 目录下创建了一个名为 api 的suite 
2. 创建测试文件User
	
	```
	/usr/local/php/bin/php ~/codecept g:cept api User	
	```
	>执行命令后，生成了一个tests/api/UserCept.php文件

3. 修改tests/api.suite.yml文件，添加rest module支持，修改成如下：
	
		class_name: ApiTester
			modules:
				enabled:
					- \Helper\Api
					- REST:            
            			url: 填写需要测试的项目根url
            			depends: PhpBrowser
            			part: Json  

4. 在tests/api/UserCept.php中编写测试代码, 示例如下:

		<?php
		$I = new ApiTester($scenario);
		$I->wantTo('create a user via API');
		$I->amHttpAuthenticated('service_user', '123456');
		$I->haveHttpHeader('Content-Type', 'application/x-www-form-urlencoded');
		$I->sendPOST('/users', ['name' => 'davert', 'email' => 'davert@codeception.com']);
		$I->seeResponseCodeIs(200);
		$I->seeResponseIsJson();
		$I->seeResponseContains('{"result":"ok"}');
		?>

5. 运行测试
	```bash
	/usr/local/php/bin/php ~/codecept run api
	```

##创建单元测试
1. 创建unit测试文件。默认的在 tests/ 下面已经有了一个unit suite，所以我们只需要直接创建unit测试文件即可。
	
	```
	/usr/local/php/bin/php ~/codecept g:test unit Example
	```

2. 配置项目初始化的文件。因为unit测试是要对项目里的方法、类的一些测试，所以需要在tests/unit/_bootstrap.php中将项目的初始化文件包含进来，比较简单的做法就是直接将项目web/index.php 中的内容copy过来(要注意一些路径可能需要修改)。Basic_Qq的示例:

	
		<?php
		define('END_TYPE', 'frontend');
		define('PROJECT_NAME', 'Basic_Qq');
		
		define('CODE_PATH', realpath(__DIR__.'/../../../..').'/'); #/zhongan/Base_code/Code/
		define('PROJECT_PATH', realpath(__DIR__.'/../..').'/'); #/zhongan/Base_code/Code/Basic_Qq/yii-advanced-app-2.0.6/
		define('PROJECT_END_PATH', PROJECT_PATH.END_TYPE.'/');  #/zhongan/Base_code/Code/Basic_Qq/yii-advanced-app-2.0.6/frontend
		define('ZHONGAN_PATH', CODE_PATH.'ZHONGAN'.'/');
		
		define('FRAMEWORK_PATH', CODE_PATH.'Framework/yii-vendor-2.0.6');
		
		defined('CONFIG_FILE_PATH') or define('CONFIG_FILE_PATH', '/zhongan/config');
		$envConfig = require(CONFIG_FILE_PATH . '/env.php');
		
		defined('YII_ENV') or define('YII_ENV', $envConfig);
		defined('YII_DEBUG') or define('YII_DEBUG', YII_ENV != 'prod');      //true false 只在dev环境下需要debug
		
		require(FRAMEWORK_PATH . '/autoload.php');
		require(FRAMEWORK_PATH . '/yiisoft/yii2/Yii.php');
		
		require(PROJECT_PATH . 'common/config/bootstrap.php');  //基本的环境变量的配置都在这里
		require(PROJECT_END_PATH.'config/bootstrap.php');
		
		define('RUNTIME_MODE', \ZHONGAN\yii\help\RunTimeMode::easyGetRunTimeMode());
			
		$config = \yii\helpers\ArrayHelper::merge(require(ZHONGAN_PATH.'yii/config/main.php') ,require(PROJECT_END_PATH . 'config/main.php'), require_once (PROJECT_END_PATH . 'config/main-'.YII_ENV.'.php'));
		$application = new yii\web\Application($config);

3. 在Example.php文件中编写测试代码
	
		<?php
		
		class ExampleTest extends \Codeception\TestCase\Test
		{
		    /**
		     * @var \UnitTester
		     */
		    protected $tester;
	
		    protected function _before()
		    {
		    }
		
		    protected function _after()
		    {
		    }
		
		    //测试BanfeiClass::findOne是否正常
		    public function testMe()
		    {
		       $classId = 784; 
		       $class = \banfei\mdl\BanfeiClass::findOne($classId);
		       $this->assertEquals('cc222',$class->name);
		    }
		
		    //对获取汉字的拼音首字母方法测试
		    public function testGetFirstChar()
		    {
		       $obj = new \ZHONGAN\help\string\HzToPy();
		       $a = "众";
		       $py = $obj->getfirstchar($a);
		       //断言'众'的首字母应该是z
		       $this->assertEquals('Z',$py);
		       $b = "安";
		       //断言'安'的首字母不是b
		       $py = $obj->getfirstchar($b);
		       $this->assertNotEquals('B',$py);
		    }
		}


4. 运行测试
	>php ~/codecept run unit
	
	结果:
	
		Codeception PHP Testing Framework v2.1.3
		Powered by PHPUnit 4.8.21 by Sebastian Bergmann and contributors.
		
		Unit Tests (3) ----------------------------------------------------------------------------------------------------------------------------
		Test me (ExampleTest::testMe)                                                                                                        Fail
		Test get first char (ExampleTest::testGetFirstChar)                                                                                  Ok
		-------------------------------------------------------------------------------------------------------------------------------------------


#总结
以上就是Codeception大致的使用方法，可能写的不太清晰，有问题多看官方文档:http://codeception.com/， 不清楚的也可以直接找我交流。